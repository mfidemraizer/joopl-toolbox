"use strict";(function(){$namespace.register("joopl.collections",function(){this.InvalidOperationException=$def({$extends:$global.joopl.Exception,$constructor:function(n){this.$base.$ctor(n)}})})})(),function(){$namespace.register("joopl",function(){this.Convert=new($def({$members:{toObject:function(n,t){switch(typeof n){case"number":return new Number(n);case"string":return new String(n);case"boolean":return new Boolean(n);default:if(t)throw new this.ArgumentException({argName:"value",reason:"Primitive type not supported"});else return n}}}}))})}(),function(){$namespace.register("joopl.collections",function(){this.Enumerator=$def({$members:{moveNext:function(){throw new $global.joopl.NotImplementedException;},hasNext:function(){throw new $global.joopl.NotImplementedException;}}})})}(),function(){$namespace.register("joopl.collections",function(){this.Enumerable=$def({$members:{get enumerator(){throw new $global.joopl.NotImplementedException;},reverse:function(){throw new $global.joopl.NotImplementedException;},forEach:function(n){for(var t=this.$_.$derived.enumerator,i;t.hasNext();)i=t.moveNext(),n(i);return this},singleOrNull:function(n){var t=this.where(n);if(t.count()>1)throw new $global.joopl.InvalidOperationException({message:"Sequence contains more than one element"});return t.firstOrNull()},single:function(n){var t=this.singleOrNull(n);if(t===null)throw new $global.joopl.InvalidOperationException({message:"Sequence contains no elements"});return t},firstOrNull:function(n){var r=this.$_.$derived.enumerator,t=!1,i=null,u;if(n){while(!t&&r.hasNext())u=r.moveNext(),t=n(u);t&&(i=u,t=!0)}else i=r.moveNext(),t=i!=undefined;return t?i:null},first:function(n){var t=this.firstOrNull(n);if(t!==null)return t;throw new $global.joopl.InvalidOperationException({message:"Sequence contains no elements"});},last:function(n){var t=this.$_.$derived.reverse();return t.first(n)},lastOrNull:function(n){var t=this.$_.$derived.reverse();return t.firstOrNull(n)},count:function(n){var t=0;return n instanceof Function?this.forEach(function(i){n(i)&&t++}):this.forEach(function(){t++}),t},where:function(n){var t=new $global.joopl.collections.List;return this.forEach(function(i){n(i)&&t.add(i)}),t}}})})}(),function(){$namespace.register("joopl.collections",function(){this.ListEnumerator=$def({$constructor:function(n){this.$_.itemArray=n.itemArray,this.$_.index=-1},$extends:this.Enumerator,$members:{moveNext:function(){return this.$_.itemArray[++this.$_.index]},hasNext:function(){return this.$_.index+1<this.$_.itemArray.length}}})})}(),function(){$namespace.register("joopl.collections",function(){this.List=$def({$extends:this.Enumerable,$constructor:function(){this.$_.itemArray=[]},$members:{get enumerator(){return new $global.joopl.collections.ListEnumerator({itemArray:this.$_.itemArray})},reverse:function(){for(var t=this.$_.itemArray.slice().reverse(),i=new $global.joopl.collections.List,n=0;n<t.length;n++)i.add(t[n]);return i},count:function(n){return n instanceof Function?this.$base.count(n):this.$_.itemArray.length},itemAt:function(n){return this.$_.itemArray[n]},indexOf:function(n){var i=-1,t=!1,r=this.enumerator;do i++,t=r.moveNext()==n;while(!t&&r.hasNext());return t?i:-1},add:function(n){this.$_.itemArray.push(n)},addRange:function(n){n.forEach(function(n){this.$_.$derived.add(n)}.bind(this))},insertAt:function(n,t){this.$_.itemArray.splice(n,0,t)},replaceAt:function(n,t){this.$_.itemArray[n]=t},remove:function(n){this.removeAt(this.indexOf(n))},removeAt:function(n){this.$_.itemArray.splice(n,1)},toString:function(){var t=[],n;for(n in this.$_.itemArray)this.$_.itemArray[n]!==undefined&&t.push(this.$_.itemArray[n].toString());return t.join(", ")}}})})}(),function(){$namespace.register("joopl.collections",function(){this.TypedList=$def({$extends:this.List,$constructor:function(n){if(typeof n!="object"||typeof n.T!="function")throw new $global.joopl.ArgumentException({argName:"args",reason:"TypedList has no parameterless constructor. Requires the 'T' argument - collection type -"});this.$base.$ctor(),this.$_.T=n.T},$members:{get T(){return this.$_.T},indexOf:function(n){if(typeof n!="Object"&&(n=$global.joopl.Convert.toObject(n)),!(n instanceof this.T))throw new $global.joopl.ArgumentException({argName:"item",reason:"Cannot find the item index. Wrong item type"});return this.$base.indexOf(n)},add:function(n){if(typeof n!="Object"&&(n=$global.joopl.Convert.toObject(n)),!(n instanceof this.T))throw new $global.joopl.ArgumentException({argName:"item",reason:"Cannot add the item. Wrong item type"});this.$base.add(n)},addRange:function(n){n.forEach(function(n){this.add(n)}.bind(this))},insertAt:function(n,t){if(typeof t!="Object"&&(t=$global.joopl.Convert.toObject(t)),!(t instanceof this.T))throw new $global.joopl.ArgumentException({argName:"item",reason:"Cannot insert the item at the given index. Wrong item type"});this.$base.insertAt(n,t)},replaceAt:function(n,t){if(typeof t!="Object"&&(t=$global.joopl.Convert.toObject(t)),!(t instanceof this.T))throw new $global.joopl.ArgumentException({argName:"item",reason:"Cannot replace the item at the given index. Wrong item type"});this.$base.replaceAt(n,t)},remove:function(n){if(typeof n!="Object"&&(n=$global.joopl.Convert.toObject(n)),!(n instanceof this.T))throw new $global.joopl.ArgumentException({argName:"item",reason:"Cannot remove the item. Wrong item type"});this.removeAt(this.indexOf(n))}}})})}(),function(){$namespace.register("joopl.collections",function(){this.ObservableChange=new($def({$members:{get added(){return 0},get replaced(){return 1},get removed(){return 2}}}))})}(),function(){$namespace.register("joopl.collections",function(){var n=this;this.ObservableList=$def({$extends:this.List,$constructor:function(n){this.$base.$ctor(n)},$members:{$events:["changed"],add:function(t){this.$base.add(t),this.changed({source:this,changeKind:n.ObservableChange.added,item:t})},insertAt:function(t,i){this.$base.insertAt(t,i),this.changed({source:this,changeKind:n.ObservableChange.added,item:i})},replaceAt:function(t,i){this.$base.replaceAt(t,i),this.changed({source:this,changeKind:n.ObservableChange.replaced,oldItem:this.getItemAt(t),item:i})},remove:function(t){this.$base.remove(t),this.changed({source:this,changeKind:n.ObservableChange.removed,item:t})},removeAt:function(t){this.$base.removeAt(t),this.changed({source:this,changeKind:n.ObservableChange.removed,item:this.getItemAt(t)})}}})})}(),function(){$namespace.register("joopl.collections",function(){var n=this;this.Index=$def({$extends:n.Enumerable,$constructor:function(n){if(typeof n!="object"&&typeof n!="object")throw new $global.joopl.ArgumentException({argName:"args",reason:"The constructor requires parameters"});if(typeof n.source!="object")throw new $global.joopl.ArgumentException({argName:"property",reason:"Indexes must be associated to a source"});if(typeof n.property!="string")throw new $global.joopl.ArgumentException({argName:"property",reason:"Indexes require which property must be indexed"});this.$_.source=n.source,this.$_.property=n.property,this.$_.unique=typeof n.unique=="boolean"?n.unique:!1},$members:{get source(){return this.$_.source},get unique(){return this.$_.unique},get property(){return this.$_.property},onDataChange:function(){}}})})}(),function(){$namespace.register("joopl.collections",function(){var n=this;this.OrderedStringIndex=$def({$extends:n.Index,$constructor:function(t){this.$base.$ctor(t),this.$_.partitions=new n.List,this.$_.vocalPartitionRegEx=new RegExp("^(a|e|i|o|u|aa|ae|ai|ao|au|ea|ee|ei|eo|eu|ia|ie|io|iu|oa|oe|oi|oo|ou|ua|ue|ui|uo|uu)","i"),this.$_.consonantPartitionRegEx=new RegExp("^(b|c|รยง|d|f|g|h|j|k|l|m|n|p|q|r|s|t|v|w|x|y|z)","i"),this.$_.numericAndSymbol=new RegExp("^[A-Za-z]","i"),this.initialize()},$members:{get enumerator(){return this.source.enumerator},get vocalPartitionRegEx(){return this.$_.vocalPartitionRegEx},get consonantPartitionRegEx(){return this.$_.consonantPartitionRegEx},initialize:function(){var i=this.$_.partitions,u="abcdefghijklmnopqrstuvwxyz",r="aeiou",t=null,f=null,e,o;i.add({id:"other",store:new n.List});for(e in u)if(t=u[e],r.indexOf(t)==0){i.add({id:t,store:new n.List});for(o in r)f=r[o],i.add({id:t+f,store:new n.List})}else i.add({id:t,store:new n.List})},findPartition:function(n){var t=null,i=this.vocalPartitionRegEx.test(n);return t=i?this.vocalPartitionRegEx.test(n.toLowerCase())?n.length>1&&this.vocalPartitionRegEx.test(n.substring(1,1).toLowerCase())?n.substring(0,2):n[0]:n[0]:this.consonantPartitionRegEx.test(n[0].toLowerCase())?n[0]:"other",t=t.toLowerCase(),this.$_.partitions.singleOrNull(function(n){return n.id==t})},onDataChange:function(t){switch(t.changeKind){case n.ObservableChange.added:this.onAdded({item:t.item});break;case n.ObservableChange.replaced:this.onReplaced({item:t.item});break;case n.ObservableChange.removed:this.onRemoved({item:t.item})}},onAdded:function(n){var i=this.property,r=n.item[i],u=this.propertySelectorFunc,t=this.findPartition(r);if(this.unique)if(t.store.count(function(n){return n[i]===r})==0)t.store.add(n.item);else throw new $global.joopl.ArgumentException({argName:"item",reason:"Unique index violation"});else t.store.add(n.item)},onReplaced:function(n){var t=this.findPartition(n.item),i;if(this.unique&&t.store.count(function(t){return t.value==n.item})>0)throw new $global.joopl.ArgumentException({argName:"item",reason:"Unique index violation"});i=t.store.indexOf(n.oldItem),t.store.replaceAt(i,n.item)},onRemoved:function(n){var t=this.findPartition(n.item),i=t.store.indexOf(n.item);t.store.removeAt(replacedItemIndex)},forEach:function(){throw new $global.joopl.NotImplementedException;},reverse:function(){throw new $global.joopl.NotImplementedException;},single:function(n,t){var i=this.findPartition(n[this.property]);return i.store.single(t.bind(n[this.property]))},singleOrNull:function(n,t){var i=this.findPartition(n[this.property]);return i.store.singleOrNull(t.bind(n[this.property]))},first:function(n,t){var i=this.findPartition(n[this.property]);return i.store.first(t.bind(n[this.property]))},firstOrNull:function(n,t){var i=this.findPartition(n[this.property]);return i.store.firstOrNull(t.bind(n[this.property]))},last:function(n,t){var i=this.findPartition(n[this.property]);return i.store.last(t.bind(n[this.property]))},lastOrNull:function(n,t){var i=this.findPartition(n[this.property]);return i.store.lastOrNull(t.bind(n[this.property]))},count:function(n,t){var i=this.findPartition(n[this.property]);return i.store.count(t.bind(n[this.property]))},where:function(n,t){var i=this.findPartition(n[this.property]);return i.store.where(t.bind(n[this.property]))}}})})}(),function(){$namespace.register("joopl.collections",function(){var n=this;this.IndexedList=$def({$extends:n.ObservableList,$constructor:function(t){this.$base.$ctor(t),this.$_.indexes=new n.List,this.changed=this.list_changed},$members:{add:function(n){this.$base.add(n)},addIndex:function(t){if(t.isTypeOf(n.Index))this.$_.indexes.add(t);else throw new $global.joopl.ArgumentException({argName:"index",reason:"Given object is not an index"});},decideIndexOrSequence:function(t,i,r){var c;if(t instanceof Function)return r();var f={},o=null,u=Object.keys(t);if(typeof t[u[0]]!="function")f[u[0]]=t[u[0]],o=t[u[1]];else if(typeof t[u[1]]=="function")f=t[u[1]],o=t[u[0]];else throw new $global.joopl.ArgumentException({argName:"predicateFuncOrIndexedSearch",reason:"The indexed search requires a property selector"});var l=u[0],e=this.$_.indexes.single(function(n){return n.property==l}),h=new n.List,s=null;for(c in f[e.property])s={},s[e.property]=f[e.property][c],h.addRange(i(e,s,o));return h},where:function(n){var t=this;return this.decideIndexOrSequence(n,function(n,t,i){return n.where(t,i)},function(){return t.$base.where(n)})},list_changed:function(n){this.$_.indexes.forEach(function(t){t.onDataChange(n)})}}})})}()