!function(){"use strict";$namespace.register("joopl.collections",function(){this.InvalidOperationException=$def({$extends:$global.joopl.Exception,$constructor:function(a){this.$base.$ctor(a)}})})}(),function(){"use strict";$namespace.register("joopl",function(){this.Convert=new($def({$members:{toObject:function(a,b){switch(typeof a){case"number":return new Number(a);case"string":return new String(a);case"boolean":return new Boolean(a);default:if(b)throw new this.ArgumentException({argName:"value",reason:"Primitive type not supported"});return a}}}}))})}(),function(){$namespace.register("joopl.collections",function(){this.Enumerator=$def({$members:{moveNext:function(){throw new $global.joopl.NotImplementedException},hasNext:function(){throw new $global.joopl.NotImplementedException}}})})}(),function(){$namespace.register("joopl.collections",function(){this.Enumerable=$def({$members:{get enumerator(){throw new $global.joopl.NotImplementedException},reverse:function(){throw new $global.joopl.NotImplementedException},forEach:function(a){for(var b=this.$_.$derived.enumerator;b.hasNext();){var c=b.moveNext();a(c)}return this},singleOrNull:function(a){var b=this.where(a);if(b.count()>1)throw new $global.joopl.InvalidOperationException({message:"Sequence contains more than one element"});return b.firstOrNull()},single:function(a){var b=this.singleOrNull(a);if(null===b)throw new $global.joopl.InvalidOperationException({message:"Sequence contains no elements"});return b},firstOrNull:function(a){var b=this.$_.$derived.enumerator,c=!1,d=null;if(a){for(;!c&&b.hasNext();){var e=b.moveNext();c=a(e)}c&&(d=e,c=!0)}else d=b.moveNext(),c=void 0!=d;return c?d:null},first:function(a){var b=this.firstOrNull(a);if(null!==b)return b;throw new $global.joopl.InvalidOperationException({message:"Sequence contains no elements"})},last:function(a){var b=this.$_.$derived.reverse();return b.first(a)},lastOrNull:function(a){var b=this.$_.$derived.reverse();return b.firstOrNull(a)},count:function(a){var b=0;return a instanceof Function?this.forEach(function(c){a(c)&&b++}):this.forEach(function(){b++}),b},where:function(a){var b=new $global.joopl.collections.List;return this.forEach(function(c){a(c)&&b.add(c)}),b}}})})}(),function(){"use strict";$namespace.register("joopl.collections",function(){this.ListEnumerator=$def({$constructor:function(a){this.$_.itemArray=a.itemArray,this.$_.index=-1},$extends:this.Enumerator,$members:{moveNext:function(){return this.$_.itemArray[++this.$_.index]},hasNext:function(){return this.$_.index+1<this.$_.itemArray.length}}})})}(),function(){"use strict";$namespace.register("joopl.collections",function(){this.List=$def({$extends:this.Enumerable,$constructor:function(){this.$_.itemArray=[]},$members:{get enumerator(){return new $global.joopl.collections.ListEnumerator({itemArray:this.$_.itemArray})},reverse:function(){for(var a=this.$_.itemArray.slice().reverse(),b=new $global.joopl.collections.List,c=0;c<a.length;c++)b.add(a[c]);return b},count:function(a){return a instanceof Function?this.$base.count(a):this.$_.itemArray.length},itemAt:function(a){return this.$_.itemArray[a]},indexOf:function(a){var b=-1,c=!1,d=this.enumerator;do b++,c=d.moveNext()==a;while(!c&&d.hasNext());return c?b:-1},add:function(a){this.$_.itemArray.push(a)},addRange:function(a){a.forEach(function(a){this.$_.$derived.add(a)}.bind(this))},insertAt:function(a,b){this.$_.itemArray.splice(a,0,b)},replaceAt:function(a,b){this.$_.itemArray[a]=b},remove:function(a){this.removeAt(this.indexOf(a))},removeAt:function(a){this.$_.itemArray.splice(a,1)},toString:function(){var a=[];for(var b in this.$_.itemArray)void 0!==this.$_.itemArray[b]&&a.push(this.$_.itemArray[b].toString());return a.join(", ")}}})})}(),function(){"use strict";$namespace.register("joopl.collections",function(){this.TypedList=$def({$extends:this.List,$constructor:function(a){if("object"!=typeof a||"function"!=typeof a.T)throw new $global.joopl.ArgumentException({argName:"args",reason:"TypedList has no parameterless constructor. Requires the 'T' argument - collection type -"});this.$base.$ctor(),this.$_.T=a.T},$members:{get T(){return this.$_.T},indexOf:function(a){if("Object"!=typeof a&&(a=$global.joopl.Convert.toObject(a)),!(a instanceof this.T))throw new $global.joopl.ArgumentException({argName:"item",reason:"Cannot find the item index. Wrong item type"});return this.$base.indexOf(a)},add:function(a){if("Object"!=typeof a&&(a=$global.joopl.Convert.toObject(a)),!(a instanceof this.T))throw new $global.joopl.ArgumentException({argName:"item",reason:"Cannot add the item. Wrong item type"});this.$base.add(a)},addRange:function(a){a.forEach(function(a){this.add(a)}.bind(this))},insertAt:function(a,b){if("Object"!=typeof b&&(b=$global.joopl.Convert.toObject(b)),!(b instanceof this.T))throw new $global.joopl.ArgumentException({argName:"item",reason:"Cannot insert the item at the given index. Wrong item type"});this.$base.insertAt(a,b)},replaceAt:function(a,b){if("Object"!=typeof b&&(b=$global.joopl.Convert.toObject(b)),!(b instanceof this.T))throw new $global.joopl.ArgumentException({argName:"item",reason:"Cannot replace the item at the given index. Wrong item type"});this.$base.replaceAt(a,b)},remove:function(a){if("Object"!=typeof a&&(a=$global.joopl.Convert.toObject(a)),!(a instanceof this.T))throw new $global.joopl.ArgumentException({argName:"item",reason:"Cannot remove the item. Wrong item type"});this.removeAt(this.indexOf(a))}}})})}(),function(){"use strict";$namespace.register("joopl.collections",function(){this.ObservableChange=new($def({$members:{get added(){return 0},get replaced(){return 1},get removed(){return 2}}}))})}(),function(){"use strict";$namespace.register("joopl.collections",function(){var a=this;this.ObservableList=$def({$extends:this.List,$constructor:function(a){this.$base.$ctor(a)},$members:{$events:["changed"],add:function(b){this.$base.add(b),this.changed({source:this,changeKind:a.ObservableChange.added,item:b})},insertAt:function(b,c){this.$base.insertAt(b,c),this.changed({source:this,changeKind:a.ObservableChange.added,item:c})},replaceAt:function(b,c){this.$base.replaceAt(b,c),this.changed({source:this,changeKind:a.ObservableChange.replaced,oldItem:this.getItemAt(b),item:c})},remove:function(b){this.$base.remove(b),this.changed({source:this,changeKind:a.ObservableChange.removed,item:b})},removeAt:function(b){this.$base.removeAt(b),this.changed({source:this,changeKind:a.ObservableChange.removed,item:this.getItemAt(b)})}}})})}(),function(){"use strict";$namespace.register("joopl.collections",function(){var a=this;this.Index=$def({$extends:a.Enumerable,$constructor:function(a){if("object"!=typeof a&&"object"!=typeof a)throw new $global.joopl.ArgumentException({argName:"args",reason:"The constructor requires parameters"});if("object"!=typeof a.source)throw new $global.joopl.ArgumentException({argName:"property",reason:"Indexes must be associated to a source"});if("string"!=typeof a.property)throw new $global.joopl.ArgumentException({argName:"property",reason:"Indexes require which property must be indexed"});this.$_.source=a.source,this.$_.property=a.property,this.$_.unique="boolean"==typeof a.unique?a.unique:!1},$members:{get source(){return this.$_.source},get unique(){return this.$_.unique},get property(){return this.$_.property},onDataChange:function(){}}})})}(),function(){"use strict";$namespace.register("joopl.collections",function(){var a=this;this.OrderedStringIndex=$def({$extends:a.Index,$constructor:function(b){this.$base.$ctor(b),this.$_.partitions=new a.List,this.$_.vocalPartitionRegEx=new RegExp("^(a|e|i|o|u|aa|ae|ai|ao|au|ea|ee|ei|eo|eu|ia|ie|io|iu|oa|oe|oi|oo|ou|ua|ue|ui|uo|uu)","i"),this.$_.consonantPartitionRegEx=new RegExp("^(b|c|รง|d|f|g|h|j|k|l|m|n|p|q|r|s|t|v|w|x|y|z)","i"),this.$_.numericAndSymbol=new RegExp("^[A-Za-z]","i"),this.initialize()},$members:{get enumerator(){return this.source.enumerator},get vocalPartitionRegEx(){return this.$_.vocalPartitionRegEx},get consonantPartitionRegEx(){return this.$_.consonantPartitionRegEx},initialize:function(){var b=this.$_.partitions,c="abcdefghijklmnopqrstuvwxyz",d="aeiou",e=null,f=null;b.add({id:"other",store:new a.List});for(var g in c)if(e=c[g],0==d.indexOf(e)){b.add({id:e,store:new a.List});for(var h in d)f=d[h],b.add({id:e+f,store:new a.List})}else b.add({id:e,store:new a.List})},findPartition:function(a){var b=null,c=this.vocalPartitionRegEx.test(a);return b=c?this.vocalPartitionRegEx.test(a.toLowerCase())?a.length>1&&this.vocalPartitionRegEx.test(a.substring(1,1).toLowerCase())?a.substring(0,2):a[0]:a[0]:this.consonantPartitionRegEx.test(a[0].toLowerCase())?a[0]:"other",b=b.toLowerCase(),this.$_.partitions.singleOrNull(function(a){return a.id==b})},onDataChange:function(b){switch(b.changeKind){case a.ObservableChange.added:this.onAdded({item:b.item});break;case a.ObservableChange.replaced:this.onReplaced({item:b.item});break;case a.ObservableChange.removed:this.onRemoved({item:b.item})}},onAdded:function(a){var b=this.property,c=a.item[b];this.propertySelectorFunc;var d=this.findPartition(c);if(this.unique){if(0!=d.store.count(function(a){return a[b]===c}))throw new $global.joopl.ArgumentException({argName:"item",reason:"Unique index violation"});d.store.add(a.item)}else d.store.add(a.item)},onReplaced:function(a){var b=this.findPartition(a.item);if(this.unique&&b.store.count(function(b){return b.value==a.item})>0)throw new $global.joopl.ArgumentException({argName:"item",reason:"Unique index violation"});var c=b.store.indexOf(a.oldItem);b.store.replaceAt(c,a.item)},onRemoved:function(a){var b=this.findPartition(a.item);b.store.indexOf(a.item),b.store.removeAt(replacedItemIndex)},forEach:function(){throw new $global.joopl.NotImplementedException},reverse:function(){throw new $global.joopl.NotImplementedException},single:function(a,b){var c=this.findPartition(a[this.property]);return c.store.single(b.bind(a[this.property]))},singleOrNull:function(a,b){var c=this.findPartition(a[this.property]);return c.store.singleOrNull(b.bind(a[this.property]))},first:function(a,b){var c=this.findPartition(a[this.property]);return c.store.first(b.bind(a[this.property]))},firstOrNull:function(a,b){var c=this.findPartition(a[this.property]);return c.store.firstOrNull(b.bind(a[this.property]))},last:function(a,b){var c=this.findPartition(a[this.property]);return c.store.last(b.bind(a[this.property]))},lastOrNull:function(a,b){var c=this.findPartition(a[this.property]);return c.store.lastOrNull(b.bind(a[this.property]))},count:function(a,b){var c=this.findPartition(a[this.property]);return c.store.count(b.bind(a[this.property]))},where:function(a,b){var c=this.findPartition(a[this.property]);return c.store.where(b.bind(a[this.property]))}}})})}(),function(){"use strict";$namespace.register("joopl.collections",function(){var a=this;this.IndexedList=$def({$extends:a.ObservableList,$constructor:function(b){this.$base.$ctor(b),this.$_.indexes=new a.List,this.changed=this.list_changed},$members:{add:function(a){this.$base.add(a)},addIndex:function(b){if(!b.isTypeOf(a.Index))throw new $global.joopl.ArgumentException({argName:"index",reason:"Given object is not an index"});this.$_.indexes.add(b)},decideIndexOrSequence:function(b,c,d){if(b instanceof Function)return d();var e={},f=null,g=Object.keys(b);if("function"!=typeof b[g[0]])e[g[0]]=b[g[0]],f=b[g[1]];else{if("function"!=typeof b[g[1]])throw new $global.joopl.ArgumentException({argName:"predicateFuncOrIndexedSearch",reason:"The indexed search requires a property selector"});e=b[g[1]],f=b[g[0]]}var h=g[0],i=this.$_.indexes.single(function(a){return a.property==h}),j=new a.List,k=null;for(var l in e[i.property])k={},k[i.property]=e[i.property][l],j.addRange(c(i,k,f));return j},where:function(a){var b=this;return this.decideIndexOrSequence(a,function(a,b,c){return a.where(b,c)},function(){return b.$base.where(a)})},list_changed:function(a){this.$_.indexes.forEach(function(b){b.onDataChange(a)})}}})})}();